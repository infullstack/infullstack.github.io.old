<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="I am a full stack engineer, working on big data."><meta name="keyword"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Nginx+Tomcat实现应用负载均衡</title><link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"></head><body><header class="container" id="header"><div class="header"><div class="header-left"><div class="avatar"><img src="/images/avatar-min.png"></div><div class="author"><div class="author-name"><a href="/">Ray</a></div><div class="about-me">Halo~ ，Just a Product Manager Blog</div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">归档</a></li></ul></div><div class="about-me-mask"><div class="about-me-wrap"><div class="about-me__header"><div class="avatar"><img src="/images/avatar-min.png"></div></div><ul class="socials"><li class="social-item"><span class="label"><img src="/images/socials/github.svg" alt="https://github.com/infullstack"></span><a href="https://github.com/infullstack" target="_blank" title="https://github.com/infullstack">https://github.com/infullstack</a></li><li class="social-item"><span class="label"><img src="/images/socials/email.svg" alt="infullstack@163.com"></span><span>infullstack@163.com</span></li><li class="social-item"><span class="label"><img src="/images/socials/wechat.svg" alt="onlyyanlei"></span><span>onlyyanlei</span></li></ul></div></div></div></header><div class="container post"><section class="article"><div class="title">Nginx+Tomcat实现应用负载均衡</div><div class="date">写于2016年12月30日</div><div class="content"><p>当单个应用服务器压力过大时，可以使用多个应用服务器提供服务减轻单服务器的压力，再结合一个代理转发服务器，完成tomcat的负载均衡。<br><a id="more"></a><br>部署架构图<br><img src="http://infullstack.com/wp-content/uploads/2016/12/nginx_tomcat.png" alt="" width="500" class="aligncenter size-full wp-image-100"></p>
<p>特点：<br>当请求达到nginx，nginx会根据weight和配置的服务器列表，完成请求的转发，实现应用服务器的负载均衡。<br>该架构适用于无状态共享的应用服务，因为session并没有设置共享。</p>
<h3 id="用到工具"><a href="#用到工具" class="headerlink" title="用到工具"></a>用到工具</h3><ul>
<li>nginx 1.10</li>
<li>tomcat 1.8</li>
</ul>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p><em>三个节点</em></p>
<ul>
<li>172.16.2.41 Tomcat  tomcat_41</li>
<li>172.16.2.42 Tomcat  tomcat_42</li>
<li>172.16.2.43 Nginx   nginx_43</li>
</ul>
<h2 id="配置tomcat"><a href="#配置tomcat" class="headerlink" title="配置tomcat"></a>配置tomcat</h2><h3 id="配置端口-conf-server-xml"><a href="#配置端口-conf-server-xml" class="headerlink" title="配置端口(conf/server.xml)"></a>配置端口(conf/server.xml)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;1010&quot; protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">               connectionTimeout=&quot;20000&quot;</span><br><span class="line">               redirectPort=&quot;8443&quot; /&gt;</span><br></pre></td></tr></table></figure>
<h3 id="新增首页"><a href="#新增首页" class="headerlink" title="新增首页"></a>新增首页</h3><p>新增应用服务器首页，tomcat/webapps/ROOT/index.html</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata01 ROOT]<span class="comment"># echo 'tomcat at 41 !' &gt; index.html</span></span><br><span class="line">[root@bigdata01 ROOT]<span class="comment"># cat index.html </span></span><br><span class="line">tomcat at 41 !</span><br><span class="line">[root@bigdata01 ROOT]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h3 id="启动tomcat"><a href="#启动tomcat" class="headerlink" title="启动tomcat"></a>启动tomcat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@transwarp1 bin]<span class="comment"># ./startup.sh </span></span><br><span class="line">Using CATALINA_BASE:   /mnt/disk1/ray/tomcat</span><br><span class="line">Using CATALINA_HOME:   /mnt/disk1/ray/tomcat</span><br><span class="line">Using CATALINA_TMPDIR: /mnt/disk1/ray/tomcat/temp</span><br><span class="line">Using JRE_HOME:        /usr/java/latest</span><br><span class="line">Using CLASSPATH:       /mnt/disk1/ray/tomcat/bin/bootstrap.jar:/mnt/disk1/ray/tomcat/bin/tomcat-juli.jar</span><br><span class="line">Tomcat started.</span><br><span class="line">[root@transwarp1 bin]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h3 id="配置tomcat2"><a href="#配置tomcat2" class="headerlink" title="配置tomcat2"></a>配置tomcat2</h3><p>方法同上。</p>
<h2 id="部署Nginx"><a href="#部署Nginx" class="headerlink" title="部署Nginx"></a>部署Nginx</h2><h2 id="Nginx-安装"><a href="#Nginx-安装" class="headerlink" title="Nginx 安装"></a>Nginx 安装</h2><p>参考文章：<a href="http://www.runoob.com/linux/nginx-install-setup.html" target="_blank" rel="noopener">Nginx 安装配置</a></p>
<h3 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    upstream infullstack.com&#123;  #集群名称</span><br><span class="line">	    server	172.16.2.41:1010	weight=1;# 服务器列表，请求会转发到这些服务器</span><br><span class="line">	    server	172.16.2.42:1010	weight=2;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       88;  # nginx端口</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass	http://infullstack.com; #集群名称</span><br><span class="line">            proxy_redirect	default;</span><br><span class="line">        &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="启动和访问Nginx"><a href="#启动和访问Nginx" class="headerlink" title="启动和访问Nginx"></a>启动和访问Nginx</h2><p>访问<a href="http://172.16.2.43:88/" target="_blank" rel="noopener">http://172.16.2.43:88/</a></p>
<p>刷新页面，会发现请求会转发到41和42服务器</p>
<p><img src="http://infullstack.com/wp-content/uploads/2016/12/41.png" alt="" width="505" height="142" class="alignnone size-full wp-image-101"><br><img src="http://infullstack.com/wp-content/uploads/2016/12/42.png" alt="" width="586" height="189" class="alignnone size-full wp-image-102"></p>
<p>根据应用服务器的配置和需求，可以修改weight，配置服务器的权重。</p>
</div><div class="tags"><a class="tag-link" href="/tags/nginx/">nginx</a><a class="tag-link" href="/tags/tomcat/">tomcat</a><a class="tag-link" href="/tags/负载均衡/">负载均衡</a></div></section></div><div class="container"><ul class="nav"><li>上一篇：<a href="/jfinal-auth.html">JFinal增加简单权限认证功能</a></li><li>下一篇：<a href="/shell-concruent.html">实现shell并发</a></li></ul></div><div id="backToTop"><div class="back-arrow back-arrow-left"></div><div class="back-arrow back-arrow-right"></div></div><footer class="container"><div class="rights"><span>Powered by </span><a href="http://hexo.io" target="_blank">Hexo</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-curry" target="_blank">Curry</a><span>.</span></div></footer><script src="/script/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/script/index.js"></script><script src="/script/post.js"></script></body></html>