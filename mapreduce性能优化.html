<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <title>Ray</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
  <body class="typo">
    <header class="header container">
  <div class="sidebar menu">
    <nav class="navbar">
      <ul class="menu">
        
          <li class="menu-item">
            <a href="/" class="menu-item-link"><i class="fa fa-th-large"></i></a>
          </li>
        
          <li class="menu-item">
            <a href="/archives" class="menu-item-link"><i class="fa fa-list-alt"></i></a>
          </li>
        
          <li class="menu-item">
            <a href="/about.html" class="menu-item-link"><i class="fa fa-user-o"></i></a>
          </li>
        
          <li class="menu-item">
            <a href="/atom.xml" class="menu-item-link"><i class="fa fa-rss"></i></a>
          </li>
        
      </ul>
    </nav>
  </div>
</header>

    <main class="container">
    	<article class="single post">
  <div class="post-menu">
	<a class="button" href="/" class="logo">返回首页</a>
  </div>

  <div class="post-title">
    <h1 class="title">mapreduce性能优化</h1>
  </div>
  <div class="post-meta">

    <span class="original">原创</span>

   	
	  <span class="article-delim"><i class="fa fa-sun-o"></i></span>
    <span class="post-time">2015-04-29</span>

    <span class="article-delim"><i class="fa fa-file-word-o"></i></span>
    <span class="post-count">共 448 字</span>

    <span class="article-delim"><i class="fa fa-clock-o"></i></span>
     <span class="post-count">读完需要 1 分钟</span>
  </div>

  <div class="post-content">
    <h2 id="基本"><a href="#基本" class="headerlink" title="基本"></a>基本</h2><ol>
<li>要减少网络延迟，配置所有节点在同一子网</li>
<li>不使用虚拟机</li>
<li>noatime挂载磁盘，文件访问数据不会被记录</li>
<li>节点磁盘不要做RAID和LVM</li>
</ol>
<h2 id="map和reduce-task设置"><a href="#map和reduce-task设置" class="headerlink" title="map和reduce task设置"></a>map和reduce task设置</h2><ol>
<li>设置map执行结束之后再执行reduce任务，mapreduce.job.reduce.slowstart.completedmaps设置成1</li>
<li>如果每个task的执行时间少于30到40秒，就减少task的数量。Task的创建与调度一般耗费几秒的时间，如果task完成的很快，我们就是在浪费时间。同时，设置JVM重用也可以解决这个问题。</li>
<li>如果一个job的输入数据大于1TB，我们就增加block size到256或者512，这样可以减少task的数量。你可以使用这个命令去修改已存在文件的block size: hadoop distcp -Ddfs.block.size=$[256<em>1024</em>1024] /path/to/inputdata  /path/to/inputdata-with/largeblocks。在执行完这个命令后，你就可以删除原始的输入文件了(/path/to/inputdata)。</li>
<li>不要调度太多的reduce task — 对于大多数job来说，我们推荐reduce task的数量应当略小于cluster中reduce slot的倍数</li>
<li>设置LZO压缩，压缩reduce输出结果，因为副本数为3，压缩输出可以节省空间和提高性能，同时设置mapred.compress.map.output值为true。</li>
</ol>
<h2 id="程序编写优化"><a href="#程序编写优化" class="headerlink" title="程序编写优化"></a>程序编写优化</h2><ol>
<li>使用最合适最简洁的writable类型，大数据量的数值和文本间的转换会消耗大量CPU时间</li>
<li>重用writable类型，避免重复的new Text” 或”new IntWritable</li>
<li>使用StringBuffer.append来连接字符串</li>
</ol>
<h2 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h2><ol>
<li>如果是测试环境，可以取消hadoop hdfs的用户权限检查。打开conf/hdfs-site.xml，找到dfs.permissions属性修改为false（默认为true）OK了。</li>
<li>timeout 设置大点，避免长时间的任务超时而停止执行</li>
</ol>

  </div>

  <div class="share">
          <div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a>

          </div>

          <div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a>

          </div>

          <div class="twitter"><a href="http://twitter.com/home?status=http://misray.com" class="fa fa-twitter"></a>

          </div>

        </div>
</article>
		<div class="footer">
	<div class="footer-title">Thanks For Visiting</div>
	<div class="">Designed by Lei Yan, Proudly published with Hexo !</div>
</div>
    </main>
  </body>
</html>