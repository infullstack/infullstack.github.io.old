<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="I am a full stack engineer, working on big data."><meta name="keyword"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>动态加载多说评论</title><link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"></head><body><header class="container" id="header"><div class="header"><div class="header-left"><div class="avatar"><img src="/images/avatar-min.png"></div><div class="author"><div class="author-name"><a href="/">Ray</a></div><div class="about-me">Halo~ ，Just a Product Manager Blog</div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">归档</a></li></ul></div><div class="about-me-mask"><div class="about-me-wrap"><div class="about-me__header"><div class="avatar"><img src="/images/avatar-min.png"></div></div><ul class="socials"><li class="social-item"><span class="label"><img src="/images/socials/github.svg" alt="https://github.com/infullstack"></span><a href="https://github.com/infullstack" target="_blank" title="https://github.com/infullstack">https://github.com/infullstack</a></li><li class="social-item"><span class="label"><img src="/images/socials/email.svg" alt="infullstack@163.com"></span><span>infullstack@163.com</span></li><li class="social-item"><span class="label"><img src="/images/socials/wechat.svg" alt="onlyyanlei"></span><span>onlyyanlei</span></li></ul></div></div></div></header><div class="container post"><section class="article"><div class="title">动态加载多说评论</div><div class="date">写于2015年10月28日</div><div class="content"><p>由于博客使用了异步加载，本来想用angularjs，但angularjs对于一个小博客来说有点重了，所以还是使用了pushState + Ajax(pjax)，于是多说也需要实现动态加载。</p>
<a id="more"></a>
<h3 id="多说代码"><a href="#多说代码" class="headerlink" title="多说代码"></a>多说代码</h3><ul>
<li>引入多说JS</li>
<li>点击按钮，展示多说评论</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;span id=&quot;expandComments&quot; onclick=&quot;toggleDuoshuoComments(&apos;#comment-box&apos;);&quot;&gt;展开评论&lt;/span&gt;</span><br><span class="line">&lt;div id=&quot;comment-box&quot; &gt;&lt;/div&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">var duoshuoQuery = &#123;short_name:&quot;misray&quot;&#125;;</span><br><span class="line">function toggleDuoshuoComments(container)&#123;</span><br><span class="line">	$(&quot;#expandComments&quot;).hide();</span><br><span class="line">    var el = document.createElement(&apos;div&apos;);//该div不需要设置class=&quot;ds-thread&quot;</span><br><span class="line">    el.setAttribute(&apos;data-thread-key&apos;, &apos;&lt;?php echo $post_id ;?&gt;&apos;);//必选参数</span><br><span class="line">    el.setAttribute(&apos;data-url&apos;, &apos;&lt;?php the_url(); ?&gt;&apos;);//必选参数</span><br><span class="line">    el.setAttribute(&apos;data-author-key&apos;, &apos;misray&apos;);//可选参数</span><br><span class="line">	el.setAttribute(&apos;data-title&apos;, &apos;&lt;?php the_title(); ?&gt;&apos;);//可选参数</span><br><span class="line">    DUOSHUO.EmbedThread(el);</span><br><span class="line">    jQuery(container).append(el);</span><br><span class="line">&#125;</span><br><span class="line">(function() &#123;</span><br><span class="line">	var ds = document.createElement(&apos;script&apos;);</span><br><span class="line">	ds.type = &apos;text/javascript&apos;;ds.async = true;</span><br><span class="line">	ds.src = (document.location.protocol == &apos;https:&apos; ? &apos;https:&apos; : &apos;http:&apos;) + &apos;//static.duoshuo.com/embed.js&apos;;</span><br><span class="line">	ds.charset = &apos;UTF-8&apos;;</span><br><span class="line">	(document.getElementsByTagName(&apos;head&apos;)[0]</span><br><span class="line">	 || document.getElementsByTagName(&apos;body&apos;)[0]).appendChild(ds);</span><br><span class="line">&#125;)();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="CSS-样式"><a href="#CSS-样式" class="headerlink" title="CSS 样式"></a>CSS 样式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#expandComments&#123;</span><br><span class="line">	padding: 8px 15px;</span><br><span class="line">	border: 1px solid #ff5e52;</span><br><span class="line">	text-decoration: none;</span><br><span class="line">	cursor: hand;</span><br><span class="line">	border-color: #ff5e52;</span><br><span class="line">	color:#fff;</span><br><span class="line">	border-radius: 10px;</span><br><span class="line">	background-color: #ff5e52;</span><br><span class="line">&#125;</span><br><span class="line">#expandComments:hover&#123;</span><br><span class="line">	color:#ff5e52;</span><br><span class="line">	border: 1px solid #ddd;</span><br><span class="line">	background-color: #fff;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tags"><a class="tag-link" href="/tags/javascript/">javascript</a></div></section></div><div class="container"><ul class="nav"><li>上一篇：<a href="/a-english-song.html">一首英文歌</a></li><li>下一篇：<a href="/2016nba.html">nba2016赛季前瞻</a></li></ul></div><div id="backToTop"><div class="back-arrow back-arrow-left"></div><div class="back-arrow back-arrow-right"></div></div><footer class="container"><div class="rights"><span>Powered by </span><a href="http://hexo.io" target="_blank">Hexo</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-curry" target="_blank">Curry</a><span>.</span></div></footer><script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script><link href="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet"><script type="text/javascript" src="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="/script/index.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/instantclick/3.1.0/instantclick.min.js"></script><script type='text/javascript' data-no-instant>InstantClick.init();</script><script src="/script/post.js"></script></body></html>